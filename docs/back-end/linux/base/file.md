---
sidebarDepth: 2
---

## 概念

### 路径说明

+ 绝对路径：以 / 开头的路径，如 `/etc/passwd`
+ 相对路径：不是以 / 开头的路径，如 `../var/log`，而且：
  + `.`：表示当前目录，相当于 `./`
  + `..`：表示上一层目录，相当于 `../`


### 文件类型

+ 在 Linux 中，目录也是文件，他的文件类型为目录(d)
+ 文件种类，括号内符号表示在文件类型权限的第一位字符

|类型|子类型或说明|
|-|-|
|常规文件(-)|**纯文本文件**：ASCII，通过 `cat` 命令可读取内容<br>**二进制文件**：binary，`cat` 命令就是一个二进制文件<br>**数据文件**：data，如 `/vat/log/wtmp` 可使用 `last` 读取(使用 `cat` 会乱码)<br>|
|目录(d)|目录|
|链接文件(l)|类似 window 的快捷方式|
|设备与设备文件(b/c)|**区块设备文件**：如硬盘、软盘，能随机读写<br>**字符设备文件**：如键盘、鼠标，能一次性读取，但不能截取输出|
|数据接口文件(s)|sockets，通常用于网络上的数据交换，如 `/run` 或 `/tmp` 下的一些文件|
|数据输送文件(p)|FIFO(pipe)，主要用于解决多个程序同时读写一个文件造成的错误问题|

+ linux 文件扩展名：不影响程序的执行(其只与 x 权限有关)，可以为任一扩展名
+ 文件名限制：不超过 255 个字符，且不要使用：
```sh
# 在命令模式下有特殊意义的字符
* ? > < ; & [ ] | \ ' " ` ( ) { }
# .(隐藏文件) -(选项前缀) +
```



## 权限

### 文件权限

+ 每个文件/目录都有三种权限：
  + 用户(User)：即文件拥有者
  + 所属群组(Group)：即用户组
  + 其他人(Others)：其他非用户组的用户

+ 权限格式：
```sh
ls -l hello.txt   # 显示 hello.txt 文件的详细信息

# 文件类型权限   连接数 拥有者 所属用户组 文件大小     最后修改时间    文件名
# -rw-r--r--     1   root   root      0       11月  9 19:03  hello.txt
```

+ 文件类型权限：共 10 个字符，除第一个字符外，每三个字符构成一组
```sh
-rw-r--r-- 
# 首字符：文件类型标识
# 第一组：文件拥有者的权限，rw- 表示可读写
# 第二组：用户组内的其他用户的权限，r-- 表示只读
# 第三组：其他用户的权限，r-- 表示只读
```

+ 权限类别：r(read), w(write), x(execute)
```sh
# rwx 对应数字 421，可由二进制计算得来(r=1*2^2, w=1*2^1, x=1*2^0)
# r-- 对应数字 400(r=1*2^2, w=0*2^1, x=0*2^0)

# 但通常使用一个数值表示三个字符，即它们的和，如 rwx 为 7，r-- 为 4
# 因此，可以使用一个三位数表示文件/目录的权限：
#   -rw-r--r-- 为 644
#   -rwxrwxrwx 为 777
```

+ 对比文件和目录的权限：

|类别|操作内容|r|w|x|
|-|-|-|-|-|
|文件|数据|读数据|增删改数据|执行数据|
|目录|文件名|读文件名|修改文件名|进入该目录|

::: tip 备注：
+ `w` 权限相当重要，它能够删除、更新、新建文件/目录，千万不要随便给予其他用户
+ `r` 权限会影响 `ls` 命令的使用，以及按 tab 时的自动补全
+ `x` 权限决定能够进入目录，若要开放目录给任何人浏览，确保给予 `r` 和 `x` 权限，不要给 `w` 权限
:::


### 默认权限

+ 文件默认权限：[umask](#umask)，顾名思义它是一个计算权限的掩码，通常默认为 0022，它们指的是创建文件/目录时默认会被拿掉的权限，后 3 位分别对应 r、w、x；此外，还要明白：
  + 创建文件时的默认权限：666，即 -rw-rw-rw-
  + 创建目录时的默认权限：777，即 drwxrwxrwx
```sh
# 根据 umask 计算最终权限，022 对应 ----w--w-，因此：
# 建立文件的最终权限：(-rw-rw-rw-) - (----w--w-) ==> -rw-r--r--
# 建立目录的最终权限：(drwxrwxrwx) - (----w--w-) ==> drwxr-xr-x

# 可以修改 umask 应用于一些场景，如以下保留用户组的写入权限：
umask 002
# 根据 umask 计算最终权限，002 对应 -------w-，因此：
# 建立文件的最终权限：(-rw-rw-rw-) - (-------w-) ==> -rw-rw-r--
# 建立目录的最终权限：(drwxrwxrwx) - (-------w-) ==> drwxrwxr-x
```


### 文件隐藏属性

+ Linux 传统的文件系统(ext2, ext3, ext4)还支持设置系统隐藏属性
+ Centos 7.x 的系统默认使用 xfs 作文件系统，只支持部分的属性
+ 参考命令 [lsattr](../command/file#lsattr)、[chattr](../command/file#chattr)


### 文件特殊权限

+ 除 r、w、x 权限外，还有几类特殊的权限：`SUID`, `SGID`, `SBIT`
+ `SUID`(Set UID)：会在用户执行权限位标记 s，如 `-rwsr-xr-x`
  + 仅对二进制程序有效，且本权限仅在执行该程序过程中有效(run-time)
  + 若执行者对于该程序需要具有 x 的执行权限，他将具有该程序拥有者(owner)的权限
  + 如一般用户能修改自身的密码，是因为 /usr/bin/passwd 具有 s 权限，他们使用 passwd 会暂时获得 root 权限 

+ `SGID`(Set GID)：会在用户组执行权限位标记 s，如 `-rwx--s--x`
  + 对二进制程序有用，当执行者对程序有 x 权限时，该权限能使执行者在执行过程中获得程序的用户组支持
  + 对目录有用，当执行者对目录有 rx 权限时，该权限能使用户在此目录下的有效用户组变成该目录的用户组
  + 该权限对项目开发很有用，涉及用户组权限的分配

+ `SBIT`(Set Bit)：会在其他用户执行权限位标记 t，如 `-drwxrwxrwt`
  + 当前仅对目录有效，当用户对目录有 wx 权限时，他在该目录下创建的文件/目录，只有他和 root 能删除
  + 如 /tmp 的权限是 drwxrwxrwt，只有用户自身和 root 能删除该用户创建的文件/目录





## 目录配置规范

+ [FHS](https://www.pathname.com/fhs/)(Filesystem Hierarchy Standard)用于规范文件目录，让用户了解一般安装的软件放置在哪里
+ 按四种交互作用，区分目录：

||可分享(shareable)|不可分享(unshareable)|
|-|-|-|
|不变(static)|/usr(软件存放)|/etc(配置文件)|
||/opt(第三方辅助软件)|/boot(启动与内核文件)|
|可变动(variable)|/var/mail(用户邮箱)|/var/run(程序相关)|
||/var/spool/news(新闻组)|/var/lock(程序相关)|

+ 实际上，FHS 对目录树架构仅定义三层目录应该放置什么数据

|目录|描述|
|-|-|
|/|(root，根目录)，与启动系统有关
|/usr|(unix software resource)，与软件安装、执行有关
|/var|(variable)，与系统运行过程有关


### 根(/)

|目录|放置内容|
|-|-|
|**要求必须存在**||
|/bin|一些执行文件，并且是在单人维护模式下能使用的|
|/boot|系统启动时会使用的文件，如使用 grub2 引导时会包含 /boot/grub2 目录|
|/dev|任何设备与接口设备都以文件的形式存在于该目录|
|/etc|系统主要的配置文件，一般来说除 root 用户外只能查看，建议不要放可执行文件在这，另：<br>`/etc/opt`(必要)：放置第三方辅助软件 /opt 的相关配置文件<br>`/etc/X11`(建议)：与 X Window 有关的配置文件，尤其是 xorg.conf<br>`/etc/sgml`(建议)：与 SGML 格式有关的配置文件<br>`/etc/xml`(建议)：与 XML 格式有关的配置文件|
|/lib|系统启动时用到的函数库、/bin 或 /sbin 的命令会调用的函数库|
|/media|可删除的设备，软盘、光盘、DVD 等|
|/mnt|放置暂时挂载的设备|
|/opt|放置第三方辅助软件，如 KDE，但以前一般放在 /usr/local 目录|
|/run|系统启动后产生的各项信息；该目录使用内存来模拟，性能会好很多|
|/sbin|启动过程中需要的命令(启动、修复、还原等)|
|/srv|service，网络服务启动后需要使用的数据目录，如 /srv/www|
|/tmp|temp，暂时放置文件，任何人都能读取；需要定时清理，且不要放置重要的数据|
|/usr|见下文|
|/var|见下文|
|**建议存在**||
|/home|系统默认的用户 home 目录，如 `~`(当前用户 home 目录)、`~user1`(user1 的 home 目录)|
|/lib\<qual\>|存放与 /lib 不同格式的二进制函数库，如支持 64 位的 /lib64 函数库等|
|/root|root 的 home 目录，为了进入单人维护模式而仅挂载根目录时能够获取|


### /usr

|目录|放置内容|
|-|-|
|**要求必须存在**||
|/usr/bin/|centos7 中将 /bin 链接到该目录，因此它们是一样的，建议不要有子目录|
|/usr/local/|本机安装下载的软件，便于管理(如想安装新版本的软件，但不想删除系统自带版本时)|
|/usr/lib/|与 /lib 相同，/lib 已链接到该目录|
|/usr/sbin/|与 /sbin 基本相同，/sbin 已链接到该目录|
|/usr/share/|只读的数据文件、共享文件(几乎都是不分硬件架构的文本文件)，通常还有子目录，如：<br>`/usr/share/man`：在线帮助文件<br>`/usr/share/doc`：软件说明文档<br>`/usr/share/zoneinfo`：时区相关的文件|
|**建议存在**||
|/usr/games/|游戏相关的数据|
|/usr/include/|c/c++ 等程序的头文件(header)和包含文件(include)，用 Tarball 方式安装软件时会用到|
|/usr/libexec/|不被一般用户使用的执行文件或脚本|
|/usr/lib\<qual\>/|与 /lib\<qual\> 相同，/lib\<qual\> 已链接到该目录|
|/usr/src/|source，源代码；如内核源代码建议放置 /usr/src/Linux/ 下|


### /var

|目录|放置内容|
|-|-|
|**要求必须存在**||
|/var/cache/|程序运行过程中产生的缓存|
|/var/lib/|程序执行过程中需要使用的数据文件|
|/var/lock/|一次只能被一个程序使用的设备或文件资源，目前已移到 /run/lock 中|
|/var/log/|放置日志文件，非常重要，如 /var/log/messages、/var/log/wtmp 等|
|/var/mail/|个人电子邮箱，也被放置到 /var/spool/mail，两者通常为链接关系|
|/var/run/|与 /run 相同，该目录链接到 /run 目录|
|/var/spool/|放置一些队列数据|