---
sidebarDepth: 2
---

## 基础

+ 位运算操作的是二进制，二进制是计算机最底层的数据结构，因此速度是最快的
+ 编程语言一般会提供两种接口(位运算符、移位运算符)，用于直接操作二进制


### 有符号数和补码

+ 无符号数：如 32 位整数，能表示的数值范围为 0~2^32^
+ 有符号数：如 32 位整数，能表示的数值范围为 -2^31^~2^31^-1，这是因为其二进制最高位为符号位(1 表示负数)
+ 补码：有符号数的主要实现方式

::: tip 备注
+ 目前除了 C/C++ 外基本所有语言都只使用有符号数字
+ javascript 使用的是 64 位双精度浮点数，而且只支持 32 位整数的位运算
:::






## 位操作符

### 简介

+ 一般编程语言均支持的位运算符：
  + `~`：非，将操作数的各个二进制位取相反值(原来为 0 则变为 1，反之)
  + `&`：与，从低位开始按位比较二进制值，两者都为 1 时，结果为 1，否则为 0
  + `|`：或，从低位开始按位比较二进制值，两者任一为 1 时，结果为 1，否则为 0
  + `^`：异或，从低位开始按位比较二进制值，两者不同时，结果为 1，否则为 0

+ 对比：

|位运算符|操作数1|操作数2|结果|
|-|-|-|-|
|`~`|10001111(79)|-|0111000()|
|`&`|10001111(79)|11110011(243)|10000011(67)|
|`|`|10001111(79)|11110011(243)|11111111(255)|
|`^`|10001111(79)|11110011(243)|01111100(188)|

+ 运算过程
```js
/* ~
  ~10001111 => 79
   --------
   01110000 => 
*/

/* &
    10001111 => 79
  & 11110011 => 243
  ----------
    10000011 => 67
*/

/* |
    10001111 => 79
  | 11110011 => 243
  ----------
    11111111 => 255
*/

/* ^
    10001111 => 79
  ^ 11110011 => 243
  ----------
    01111100 => 188
*/
```


### 按位非

+ `~num` 相当于 `-num-1`
```js
const num = 12
console.log(~num === -num-1)   // true

// 封装成一个谓词函数
const opposite = num => ~num + 1
```


### 按位且

+ 判断奇偶性
```js
if (a % 2 === 0) {
  // 是偶数
}

if (a & 1 === 0) {
  // 是偶数
}
```

::: tip 说明：
+ `a & 1` 可以理解为判断二进制的最低位是否是 1，而这于奇偶性是一致的
+ 如果能理解 `a & 0` 恒等于 0，那么 `a & 1` 就容易理解了
```js
/* 二进制位标记为 x，表示它可以为 1 或 0
a & 0:
    xxxxxxxx => a
  & 00000000 => 0
  ----------
    00000000 => 0

a & 1:
    xxxxxxx1 => 奇数 a
  & 00000001 => 1
  ----------
    00000001 => 1

    xxxxxxx0 => 偶数 a
  & 00000001 => 1
  ----------
    00000000 => 0
*/
```
:::


### 按位异或

+ 对于任何数，`a ^ 0 === a`
+ 对于任何数，`a ^ a === 0`，可以用于判断两数是否相等：
```js
if (a === b) {
  // 两数相等
}

if (!(a ^ b)) {
  // 两数相等
}
```

::: tip 备注：
+ `a ^ a === 0` 是一种抵消的思想，因此在一些算法问题中，用处非常大
+ `^` 是非常巧妙的一种运算，联合其他位运算符可以实现非常复杂的功能
:::




## 移位运算符

### 简介

+ 一般编程语言均支持的移位运算符：
  + `<<`：左移，将操作数的所有二进制位向左移动指定位数，右侧空位以 0 补充
  + `>>`：有符号右移，将操作数的所有二进制位想右移动指定位数，左侧空位以符号位补充
  + `>>>`：无符号右移，将操作数的所有二进制位向右移动指定位数，左侧空位以 0 补充

::: tip 备注
+ 使用移位需要考虑溢出，如在有符号数中使用，有可能会在正负数之间切换
:::


### 左移

+ 使用 `<<` 让一个数字翻倍(无溢出时)
```js
a = 1
a = a * 2   // 常规写法
a = a << 1  // 左移写法

// 左移更快也更优雅：如需要将翻倍的操作重复 5 次
a = a * Math.pow(2, 5)  // 常规写法
a = a << 5              // 左移写法
```



### 有符号右移

+ 类比 `>>`，但该操作是不精确的，对奇数使用时会丢失精度，结果不是除以 2，而是 `Math.floor(a/2)`
```js
16 >> 1   // 8
15 >> 1   // 7

-16 >> 1  // -8
-15 >> 1  // -8
```

+ 可以用于判断一个数是否是负数
```js
/* 
  原理：使用补码的有符号数最高位标识数字的正负，0 为非负数，只需要校对最高位的值即可
  对于不同位数的数值有符号右移的位数不同，如 32 位整数为 num >> 31
*/
const isPositive = num => num === 0 ? false : ((num >> 31) & 1 === 0)
```


### 无符号右移





## Todos

实现四则运算：
+ 全加器
+ 乘法