(window.webpackJsonp=window.webpackJsonp||[]).push([[431],{870:function(t,e,a){"use strict";a.r(e);var s=a(25),v=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"loader-简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#loader-简介"}},[t._v("#")]),t._v(" loader 简介")]),t._v(" "),a("p",[t._v("参考自官方 "),a("a",{attrs:{href:"https://www.webpackjs.com/api/loaders",target:"_blank",rel:"noopener noreferrer"}},[t._v("loader API"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("loader")]),t._v(" 只是一个导出为函数的 "),a("code",[t._v("JavaScript")]),t._v(" 模块；"),a("code",[t._v("loader runner")]),t._v(" 会调用这个函数，然后把上一个 "),a("code",[t._v("loader")]),t._v(" 产生的结果或者资源文件("),a("code",[t._v("resource file")]),t._v(")传入进去；")]),t._v(" "),a("li",[t._v("函数的 "),a("code",[t._v("this")]),t._v(" 上下文由 "),a("code",[t._v("webpack")]),t._v(" 填充，并且 "),a("code",[t._v("loader runner")]),t._v(" 具有一系列方法，可以使 "),a("code",[t._v("loader")]),t._v(" 改变为异步调用方式，或者获取 "),a("code",[t._v("query")]),t._v(" 参数等；")]),t._v(" "),a("li",[a("code",[t._v("compiler")]),t._v(" 需要得到最后一个 "),a("code",[t._v("loader")]),t._v(" 产生的处理结果；这个处理结果应该是 "),a("code",[t._v("String")]),t._v(" 或者 "),a("code",[t._v("Buffer")]),t._v("(被转换为一个 "),a("code",[t._v("string")]),t._v(")，代表了模块的 "),a("code",[t._v("JavaScript")]),t._v(" 源码；另外还可以传递一个可选的 "),a("code",[t._v("SourceMap")]),t._v("(格式为 "),a("code",[t._v("JSON")]),t._v(" 对象)；")]),t._v(" "),a("li",[t._v("如果是单个处理结果，可以在同步模式中直接返回；如果有多个处理结果，则必须调用 "),a("code",[t._v("this.callback()")]),t._v("；")]),t._v(" "),a("li",[t._v("在异步模式中，必须调用 "),a("code",[t._v("this.async()")]),t._v("，来指示 "),a("code",[t._v("loader runner")]),t._v(" 等待异步结果，它会返回 "),a("code",[t._v("this.callback()")]),t._v(" 回调函数，随后 "),a("code",[t._v("loader")]),t._v(" 必须返回 "),a("code",[t._v("undefined")]),t._v(" 并且调用该回调函数。")])]),t._v(" "),a("h2",{attrs:{id:"loader-api"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#loader-api"}},[t._v("#")]),t._v(" loader API")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("语法")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("code",[t._v("this.version")])]),t._v(" "),a("td",[a("code",[t._v("loader API")]),t._v(" 版本号")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("this.context")])]),t._v(" "),a("td",[t._v("模块所在的目录")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("this.request")])]),t._v(" "),a("td",[t._v("被解析出来的 "),a("code",[t._v("request")]),t._v(" 字符串")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("this.async")])]),t._v(" "),a("td",[a("code",[t._v("loader")]),t._v(" 将会异步地回调，返回 "),a("code",[t._v("this.callback")])])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("this.data")])]),t._v(" "),a("td",[t._v("在 "),a("code",[t._v("pitch")]),t._v(" 阶段和正常阶段之间共享的 "),a("code",[t._v("data")]),t._v(" 对象")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("this.loaders")])]),t._v(" "),a("td",[t._v("所有 "),a("code",[t._v("loader")]),t._v(" 组成的数组")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("this.loaderIndex")])]),t._v(" "),a("td",[t._v("当前 "),a("code",[t._v("loader")]),t._v(" 在 "),a("code",[t._v("loaders")]),t._v(" 中的索引")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("this.resource")])]),t._v(" "),a("td",[a("code",[t._v("request")]),t._v(" 中的资源部分，包括 "),a("code",[t._v("query")]),t._v(" 参数")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("this.resourcePath")])]),t._v(" "),a("td",[t._v("资源文件的路径")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("this.resourceQuery")])]),t._v(" "),a("td",[t._v("资源的 "),a("code",[t._v("query")]),t._v(" 参数")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("this.target")])]),t._v(" "),a("td",[t._v("编译的目标。从配置选项中传递过来的")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("this.webpack")])]),t._v(" "),a("td",[t._v("如果是由 "),a("code",[t._v("webpack")]),t._v(" 编译的，这个布尔值会被设置为真")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("this.sourceMap")])]),t._v(" "),a("td",[t._v("生成一个 "),a("code",[t._v("source map")])])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("this.fs")])]),t._v(" "),a("td",[t._v("用于访问 "),a("code",[t._v("compilation")]),t._v(" 的 "),a("code",[t._v("inputFileSystem")]),t._v(" 属性")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("this.callback()")])]),t._v(" "),a("td",[t._v("一个可以同步或者异步调用的可以返回多个结果的函数")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("this.cacheable()")])]),t._v(" "),a("td",[t._v("设置是否缓存")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("this.emitWarning()")])]),t._v(" "),a("td",[t._v("发出一个警告")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("this.emitError()")])]),t._v(" "),a("td",[t._v("发出一个错误")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("this.loadModule()")])]),t._v(" "),a("td",[t._v("解析 "),a("code",[t._v("request")]),t._v(" 到一个模块，应用所有配置的 "),a("code",[t._v("loader")])])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("this.resolve()")])]),t._v(" "),a("td",[t._v("解析一个 "),a("code",[t._v("request")])])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("this.addDependency()")])]),t._v(" "),a("td",[t._v("加入一个文件作为产生 "),a("code",[t._v("loader")]),t._v(" 结果的依赖，使它们的任何变化可以被监听到")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("this.addContextDependency()")])]),t._v(" "),a("td",[t._v("把文件夹作为 "),a("code",[t._v("loader")]),t._v(" 结果的依赖加入")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("this.clearDependencies()")])]),t._v(" "),a("td",[t._v("移除 "),a("code",[t._v("loader")]),t._v(" 结果的所有依赖")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("this.emitFile()")])]),t._v(" "),a("td",[t._v("产生一个文件")])])])]),t._v(" "),a("h2",{attrs:{id:"编写-loader"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编写-loader"}},[t._v("#")]),t._v(" 编写 loader")]),t._v(" "),a("p",[a("strong",[t._v("说明：")])]),t._v(" "),a("ul",[a("li",[t._v("因为 "),a("code",[t._v("Webpack")]),t._v(" 是一个 "),a("code",[t._v("Node.js")]),t._v(" 应用，所以编写 "),a("code",[t._v("loader")]),t._v(" 时可以调用 "),a("code",[t._v("Node.js API")]),t._v(" 或安装第三方模块并引入使用")]),t._v(" "),a("li",[t._v("需要加载本地 "),a("code",[t._v("loader")]),t._v(" 时可以使用 "),a("code",[t._v("npm")]),t._v(" 的 "),a("code",[t._v("link")]),t._v(" 命令或 "),a("code",[t._v("Webpack")]),t._v(" 的 "),a("code",[t._v("resolveLoader")]),t._v(" 选项来实现")])]),t._v(" "),a("h2",{attrs:{id:"一个简单的-loader"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一个简单的-loader"}},[t._v("#")]),t._v(" 一个简单的 loader")]),t._v(" "),a("p",[t._v("  简单来说，loader 是一个函数，它接受源代码或上一个 loader 返回的结果代码作为参数，最后返回一个结果代码。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("someSyncOperation")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("content")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// do some operation")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("source")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("someSyncOperation")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("source"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"plugin-简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#plugin-简介"}},[t._v("#")]),t._v(" plugin 简介")]),t._v(" "),a("ul",[a("li",[t._v("plugin 初始化实例后会执行类的 "),a("code",[t._v("apply()")]),t._v(" 方法为插件实例传入 "),a("code",[t._v("compiler")]),t._v(" 对象，该对象内定义了回调钩子监听 "),a("code",[t._v("Webpack")]),t._v(" 的变化")])]),t._v(" "),a("h2",{attrs:{id:"编写-plugin"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编写-plugin"}},[t._v("#")]),t._v(" 编写 plugin")]),t._v(" "),a("p",[a("strong",[t._v("说明：")])]),t._v(" "),a("ul",[a("li",[a("code",[t._v("compiler")]),t._v("：该对象包含了 "),a("code",[t._v("Webpack")]),t._v(" 环境的所有配置信息("),a("code",[t._v("options")]),t._v(", "),a("code",[t._v("loaders")]),t._v(", "),a("code",[t._v("plugins")]),t._v(" 等)，在 "),a("code",[t._v("Webpack")]),t._v(" 启动时就被实例化")]),t._v(" "),a("li",[a("code",[t._v("compilation")]),t._v("：该对象包含了当前的模块资源、编译生成资源、变化的文件等信息，每当检测到一个文件变化，就会生成一个新的该对象，它还能读取到 "),a("code",[t._v("compiler")]),t._v(" 对象")]),t._v(" "),a("li",[a("code",[t._v("resolver")]),t._v("：")]),t._v(" "),a("li",[a("code",[t._v("parser")]),t._v("：")])]),t._v(" "),a("h2",{attrs:{id:"一个简单的-plugin"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一个简单的-plugin"}},[t._v("#")]),t._v(" 一个简单的 plugin")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FirstPlugin")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("constructor")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("successHandler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" failHandler")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("successHandler "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" successHandler\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("failHandler "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" failHandler\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  \n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apply")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("compiler")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    compiler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("plugin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'done'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("state")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("successHandler")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    compiler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("plugin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'failed'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("err")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("failHandler")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" FirstPlugin\n")])])])])}),[],!1,null,null,null);e.default=v.exports}}]);